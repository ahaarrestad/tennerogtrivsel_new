---
import {Image} from 'astro:assets';
import tannleger from '../content/tannleger.json';
import WaveToFooter from './WaveToFooter.astro';
import {getSiteSettings} from '../scripts/getSettings';

// For å dynamisk importere bilder i Astro
const images = import.meta.glob('/src/assets/tannleger/*.{jpeg,jpg,png,webp}');
const settings = await getSiteSettings();

const sorterteTannleger = tannleger.sort((a, b) => a.navn.localeCompare(b.navn, 'nb'));
---
<section id="tannleger" class="section-container bg-slate-50">
    <div class="section-content">
        <div class="section-header section-header-sticky bg-slate-50/95 md:bg-transparent">
            <h2 class="section-heading">Våre Tannleger</h2>
            <p class="section-intro">{settings.tannlegerTekst}</p>
            <div class="heading-accent"></div>
        </div>

        <div class="flex flex-col md:grid md:grid-cols-2 lg:grid-cols-3 gap-10">
            {sorterteTannleger.map((t, index) => {
                // VIKTIG: Definer disse variablene her inne i map-funksjonen

                const imagePath = `/src/assets/tannleger/${t.bildeFil}`;
                const hasImage = images[imagePath];

                return (
                        <div
                                style={`--card-index: ${index}; --header-offset: 240px;`}
                                class="stack-card card-base group items-center min-h-[450px]"
                        >
                            <div class="card-accent-corner"></div>

                            <div class="w-48 h-48 mb-6 overflow-hidden rounded-full border-4 border-blue-50 relative z-10 shrink-0">
                                {hasImage ? (
                                        <Image
                                                src={images[imagePath]()}
                                                alt={t.navn}
                                                width={400}
                                                height={400}
                                                class="w-full h-full object-cover"
                                        />
                                ) : (
                                        <div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400">
                                            Bilde mangler
                                        </div>
                                )}
                            </div>

                            <div class="text-center relative z-10">
                                <h3 class="card-title">{t.navn}</h3>
                                <p class="card-subtitle">{t.tittel}</p>
                                <p class="card-text line-clamp-6">
                                    {t.beskrivelse}
                                </p>
                            </div>
                            
                            <div class="card-progress-bar"></div>
                        </div>
                );
            })}
        </div>
    </div>
</section>