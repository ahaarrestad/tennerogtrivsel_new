---
import {Image} from 'astro:assets';
import {getCollection} from 'astro:content';
import {getSiteSettings} from '../scripts/getSettings';
import Card from "./Card.astro";

// Hent alle tannleger fra den nye collectionen
const tannleger = await getCollection('tannleger');
const settings = await getSiteSettings();

// For å dynamisk importere bilder i Astro
const images = import.meta.glob('/src/assets/tannleger/*.{jpeg,jpg,png,webp}');

const sorterteTannleger = tannleger.sort((a, b) => a.data.name.localeCompare(b.data.name, 'nb'));

interface Props { variant?: 'white' | 'brand' }
const { variant = 'brand' } = Astro.props;
const sectionBg = variant === 'brand' ? 'bg-brand-light' : 'bg-white';
const headerBg = variant === 'brand' ? 'bg-brand-light/95 md:bg-transparent' : 'bg-white/95';
---
<section id="tannleger" class={`section-container ${sectionBg}`}>
    <div class="section-content">
        <div class={`section-header section-header-centered section-header-sticky ${headerBg}`}>
            <h2 class="section-heading">Våre Tannleger</h2>
            <p class="section-intro">{settings.tannlegerTekst}</p>
            <div class="heading-accent"></div>
        </div>

        <div class="flex flex-col md:grid md:grid-cols-2 lg:grid-cols-3 gap-10">
            {sorterteTannleger.map((t, index) => {
                const tannlegeData = t.data;
                const imagePath = `/src/assets/tannleger/${tannlegeData.image}`;
                const hasImage = tannlegeData.image && images[imagePath];

                return (
                        <Card
                                index={index}
                                title={tannlegeData.name}
                                headerOffset="160px"
                                isStack={true}
                                image={true}
                                minHeight="450px"
                        >
                            {hasImage ? (
                                    <Image slot="image"
                                           src={images[imagePath]()}
                                           alt={tannlegeData.name}
                                           class="absolute inset-0 w-full h-full object-cover"
                                           style={{
                                               objectPosition: `${tannlegeData.imageConfig?.positionX ?? 50}% ${tannlegeData.imageConfig?.positionY ?? 50}%`,
                                               transform: `scale(${tannlegeData.imageConfig?.scale ?? 1.0})`,
                                               transformOrigin: `${tannlegeData.imageConfig?.positionX ?? 50}% ${tannlegeData.imageConfig?.positionY ?? 50}%`
                                           }}
                                    />
                            ) : (
                                    <div slot="image"
                                         class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400">
                                        Bilde mangler
                                    </div>
                            )}
                            <p class="card-subtitle">{tannlegeData.title}</p>
                            <p class="card-text line-clamp-6">
                                {tannlegeData.description}
                            </p>
                        </Card>
                );
            })}
        </div>
    </div>
</section>