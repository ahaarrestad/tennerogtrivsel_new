---
import {Image} from 'astro:assets';
import tannleger from '../content/tannleger.json';
import WaveToFooter from './WaveToFooter.astro';
import {getSiteSettings} from '../scripts/getSettings';

// For å dynamisk importere bilder i Astro
const images = import.meta.glob('/src/assets/tannleger/*.{jpeg,jpg,png,webp}');
const settings = await getSiteSettings();

const sorterteTannleger = tannleger.sort((a, b) => a.navn.localeCompare(b.navn, 'nb'));
---
<section id="tannleger" class="section-container bg-slate-50">
    <div class="section-content">

        {/* Overskrift - Samme sticky-logikk som tjenester */}
        <div class="section-header section-header-sticky bg-slate-50/95 md:bg-transparent">
            <h2 class="section-heading">Våre Tannleger</h2>
            <p class="section-intro">{settings.tannlegerTekst}</p>
            <div class="heading-accent"></div>
        </div>

        <div class="flex flex-col md:grid md:grid-cols-2 lg:grid-cols-3 gap-10">
            {sorterteTannleger.map((t, index) => {
                const imagePath = `/src/assets/tannleger/${t.bildeFil}`;
                const hasImage = images[imagePath];

                return (
                    /* Vi setter variablene her, men bruker dem bare i CSS under */

                        <div
                                style={`--card-index: ${index};`}
                                class="stack-card sticky md:relative bg-white p-8 rounded-3xl shadow-sm border border-slate-100 flex flex-col items-center mb-[10vh] md:mb-0 min-h-[450px] overflow-hidden transition-all duration-300"
                        >
                            <div class="absolute top-0 right-0 w-20 h-20 bg-blue-50 rounded-bl-full -mr-8 -mt-8"></div>

                            <div class="w-48 h-48 mb-6 overflow-hidden rounded-full border-4 border-blue-50 relative z-10 shrink-0">
                                {hasImage ? (
                                        <Image
                                                src={images[imagePath]()}
                                                alt={t.navn}
                                                width={400}
                                                height={400}
                                                class="w-full h-full object-cover"
                                        />
                                ) : (
                                        <div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400">
                                            Bilde mangler
                                        </div>
                                )}
                            </div>

                            <div class="text-center relative z-10">
                                <h3 class="text-2xl font-bold text-slate-900">{t.navn}</h3>
                                <p class="text-lg text-blue-600 font-medium italic mb-4">{t.tittel}</p>
                                <p class="text-slate-600 text-sm leading-relaxed line-clamp-6">
                                    {t.beskrivelse}
                                </p>
                            </div>

                            <div class="absolute bottom-0 left-0 h-1.5 bg-blue-600 w-0 group-hover:w-full transition-all duration-500"></div>
                        </div>
                );
            })}
        </div>
    </div>
</section>


<style>
    @media (max-width: 767px) {
        .stack-card {
            position: sticky !important;
            /* var(--nav-total-height) = navbaren
               + 220px = Omtrentlig høyde på din overskrift + intro + padding
               + (var(--card-index) * 4px) = Stacking-forskyvning
            */
            top: calc(var(--nav-total-height, 4rem) + 150px + (var(--card-index) * 4px)) !important;
            z-index: var(--card-index);
        }
    }

    @media (min-width: 768px) {
        /* På desktop skal overskriften IKKE være sticky */
        .section-header-sticky {
            position: relative !important;
            top: 0 !important;
        }

        .stack-card {
            position: relative !important;
            top: 0 !important;
            z-index: 1 !important;
            margin-bottom: 0 !important;
        }
    }

    @media (max-width: 767px) {
        /* Fjerner den ekstra marginen på det siste kortet så det ikke dytter footeren unødvendig ned */
        .stack-card:last-child {
            margin-bottom: 2rem !important;
        }
    }
</style>