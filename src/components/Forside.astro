---
import TelefonKnapp from "./TelefonKnapp.astro";
import EpostKnapp from "./EpostKnapp.astro";
import {getSiteSettings} from '../scripts/getSettings';
import KontaktKnapp from "./KontaktKnapp.astro";

import {Image} from 'astro:assets';
import hovedBilde from '../assets/hovedbilde.png'; // Importer bildefilen direkte

const settings = await getSiteSettings();
---
<section id="forside" class="section-container bg-white scroll-mt-20 md:scroll-mt-28">
    <div class="section-content">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center mb-16">

            <div class="space-y-8 order-1">
                <h1 class="h1 text-center lg:text-left">
                    {settings.velkomstTittel1}<br/>
                    <span class="text-brand">{settings.velkomstTittel2}</span>
                </h1>

                <p class="section-intro text-center lg:text-left lg:ml-0">
                    {settings.velkomstTekst}
                </p>

                <div class="hidden lg:flex flex-row flex-wrap gap-4 pt-4">
                    <TelefonKnapp/>
                    <EpostKnapp/>
                    <KontaktKnapp/>
                </div>
            </div>

            <div class="order-2 relative z-0 mb-8 lg:mb-0">
                <div class="rounded-2xl border-4 border-white shadow-md overflow-hidden aspect-[16/10] bg-white">
                    <Image
                            src={hovedBilde}
                            alt="Tenner og Trivsel"
                            class="w-full h-full object-cover object-center"
                            loading="eager"
                            fetchpriority="high"
                    />
                </div>
            </div>

            <div class="order-3 lg:hidden flex flex-wrap gap-4 justify-center md:justify-start w-full mt-4">
                <TelefonKnapp/>
                <EpostKnapp/>
                <KontaktKnapp/>
            </div>

            <div id="dynamic-message-box"
                 class="hidden card-base border-none shadow-xl mt-8 order-4 lg:col-span-2"
                 style="background-color: var(--color-brand-message-box); color: var(--color-brand);">
                <h3 id="dynamic-title" class="h3 mb-4"></h3>
                <div id="dynamic-content"
                     class="card-text markdown-content prose max-w-none"
                     style="color: inherit;">
                </div>
            </div>
        </div>
    </div>
    <script>
        import {getActiveMessage} from '../scripts/messageClient.js';

        async function updateHeroMessage() {
            const active = await getActiveMessage();
            const box = document.getElementById('dynamic-message-box');
            const title = document.getElementById('dynamic-title');
            const content = document.getElementById('dynamic-content');

            if (active && box && title && content) {
                title.textContent = active.title;
                content.innerHTML = active.htmlContent;
                box.classList.remove('hidden');
            } else if (box) {
                box.classList.add('hidden');
            }
        }

        document.addEventListener('astro:page-load', () => {
            updateHeroMessage();
            
            // Sjekk om brukeren ble sendt hit pga manglende tilgang
            if (new URLSearchParams(window.location.search).has('access_denied')) {
                alert("Du har ikke tilgang til noen av admin-modulene med din Google-konto.");
                // Fjern parameteren fra URL uten Ã¥ refreshe
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        });
        updateHeroMessage();
    </script>
</section>